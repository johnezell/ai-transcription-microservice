FROM python:3.11-slim

WORKDIR /app

# Install essential tools for audio extraction
RUN apt-get update && apt-get install -y \
    ffmpeg \
    curl \
    libsndfile1 \
    sox \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY app/services/audio-extraction/requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV FLASK_APP=service.py
ENV FLASK_ENV=development

# Phase 2: Audio Processing Configuration
ENV AUDIO_QUALITY_LEVEL=balanced
ENV ENABLE_NORMALIZATION=true
ENV FFMPEG_THREADS=4

# Phase 3: Advanced Features Configuration
ENV ENABLE_VAD=false
ENV VAD_THRESHOLD=-60dB
ENV PREMIUM_QUALITY_ENABLED=true

# Command to run the service
CMD ["python", "service.py"]