# version: '3.8' # Obsolete, can be removed

services:
  laravel: # PHP-FPM application service with Nginx running inside via supervisord
    build:
      context: . # Root of the workspace, where Dockerfile.laravel is
      dockerfile: Dockerfile.laravel
    container_name: aws-transcription-laravel-local-dev # New distinct name
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8080}:80" # Expose the container's internal Nginx port 80 on host port 8080
    volumes:
      - ./app/laravel:/var/www   # For live code changes
      - ~/.aws:/mnt/aws_creds_mounted:ro # For AWS SDK credentials
    env_file: 
      - ./app/laravel/.env.docker-aws # Populated by scripts/setup_local_env.sh
    networks:
      - app-network 

# No other services (mysql, phpmyadmin, python services, standalone nginx) are defined in this file
# for the "local Laravel with AWS backend" setup.
# If you need a fully local stack (local DB, local Python services), you would use a different docker-compose file
# or manage different override files.

networks:
  app-network: # Define the network if the laravel service is the only one using it now
    driver: bridge

# No other volumes defined if other services are removed.
