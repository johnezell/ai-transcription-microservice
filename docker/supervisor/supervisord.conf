[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

# Audio extraction and default queue worker (1 process)
[program:laravel-queue-worker]
command=php /var/www/artisan queue:work --queue=audio-extraction,default --sleep=3 --tries=3 --max-time=3600 --memory=512
directory=/var/www
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/www/storage/logs/queue-worker.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=2
stopwaitsecs=3600

# Transcription queue worker (1 process with higher memory/timeout)
[program:laravel-transcription-worker]
command=php /var/www/artisan queue:work --queue=transcription --sleep=3 --tries=3 --max-time=7200 --memory=1024
directory=/var/www
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/www/storage/logs/transcription-worker.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=2
stopwaitsecs=7200

# Vite dev server for development (optional - can be disabled in production)
[program:vite-dev]
command=/usr/local/bin/start-vite.sh
directory=/var/www
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=root
environment=NODE_ENV=development,PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/var/www/node_modules/.bin"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[include]
files = /etc/supervisor/conf.d/*.conf