[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# Audio extraction queue workers (3 processes) - PRIORITY DATABASE SYSTEM
[program:laravel-priority-audio-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/artisan queue:work priority-audio-extraction --sleep=3 --tries=3 --max-time=3600 --memory=512
directory=/var/www
autostart=true
autorestart=true
user=www-data
numprocs=3
redirect_stderr=true
stdout_logfile=/var/www/storage/logs/priority-audio-worker.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=2
stopwaitsecs=3600

# Transcription queue worker (1 process) - PRIORITY DATABASE SYSTEM
[program:laravel-priority-transcription-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/artisan queue:work priority-transcription --sleep=3 --tries=3 --max-time=7200 --memory=1024
directory=/var/www
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/storage/logs/priority-transcription-worker.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=2
stopwaitsecs=7200

# Vite dev server for development (optional - can be disabled in production)
[program:vite-dev]
command=/usr/local/bin/start-vite.sh
directory=/var/www
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=root
environment=NODE_ENV=development,PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bin:/var/www/node_modules/.bin"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[include]
files = /etc/supervisor/conf.d/*.conf